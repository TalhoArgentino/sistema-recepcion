<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Sistema de Recepci√≥n de Mercader√≠a</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .login-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 400px;
            margin: 100px auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .login-header p {
            color: #64748b;
            font-size: 14px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            color: #1e293b;
            font-size: 24px;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-badge {
            background: #fef3c7;
            color: #92400e;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #1e293b;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .scanner-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .scanner-input input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 18px;
            font-family: 'Courier New', monospace;
        }

        .scanner-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .product-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .product-item {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .product-item:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .product-name {
            font-weight: 700;
            color: #1e293b;
            font-size: 15px;
            flex: 2;
            min-width: 200px;
        }

        .product-code {
            font-family: 'Courier New', monospace;
            color: #64748b;
            font-size: 12px;
        }

        .product-stat {
            text-align: center;
            padding: 8px 12px;
            background: #f8fafc;
            border-radius: 6px;
            min-width: 80px;
        }

        .stat-label {
            font-size: 10px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin-top: 2px;
        }

        .manual-input-inline {
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 140px;
        }

        .manual-input-inline input {
            width: 100px;
            padding: 6px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .difference-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .difference-badge.positive {
            background: #dcfce7;
            color: #166534;
        }

        .difference-badge.negative {
            background: #fee2e2;
            color: #991b1b;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .actions button {
            flex: 1;
            min-width: 120px;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .admin-section {
            margin-top: 20px;
            padding: 20px;
            background: #fef3c7;
            border-radius: 12px;
            border: 2px solid #fbbf24;
        }

        .admin-section h3 {
            color: #92400e;
            margin-bottom: 16px;
            font-size: 16px;
        }

        .file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .file-upload input {
            display: none;
        }

        .product-catalog {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .catalog-item {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .catalog-item:last-child {
            border-bottom: none;
        }

        .catalog-item:hover {
            background: #f8fafc;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: #f1f5f9;
        }

        .small-btn {
            padding: 6px 12px;
            font-size: 13px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .small-btn-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .small-btn-danger:hover {
            background: #fca5a5;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            width: 100%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #1e293b;
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        .close-btn:hover {
            background: #f1f5f9;
        }

        .scan-detail-item {
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .add-product-form {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .add-product-form input[type="text"],
        .add-product-form input[type="number"] {
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
        }

        .add-product-form label {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px;
            white-space: nowrap;
        }

        .barcode-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .barcode-chip {
            background: #e0e7ff;
            color: #3730a3;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .barcode-chip button {
            background: none;
            border: none;
            color: #3730a3;
            cursor: pointer;
            padding: 0;
            font-size: 14px;
            line-height: 1;
        }

        .barcode-input-section {
            margin-top: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-date {
            font-weight: 700;
            color: #1e293b;
            font-size: 14px;
        }

        .history-badge {
            background: #f1f5f9;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            color: #475569;
            font-weight: 600;
        }

        .history-summary {
            color: #64748b;
            font-size: 13px;
        }

        .info-box {
            padding: 12px;
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            font-size: 13px;
            color: #1e40af;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Helper para c√≥digos EAN-13
        const parseBarcode = (barcode) => {
            if (!barcode || barcode.length !== 13) return null;

            const prefix = barcode.substring(0, 2);
            const productCode = barcode.substring(0, 7);
            const weightCode = barcode.substring(7, 12);

            // Auto-detectar si tiene peso basado en el prefijo
            const hasWeight = ['27', '29', '21'].includes(prefix);
            const weight = hasWeight ? parseFloat(weightCode) / 1000 : 0;

            return { 
                productCode, 
                weight, 
                hasWeight, 
                fullCode: barcode 
            };
        };

        // Funci√≥n para buscar producto por cualquiera de sus c√≥digos
        const findProductByBarcode = (barcode, products) => {
            const parsed = parseBarcode(barcode);
            if (!parsed) return null;

            // Buscar primero por c√≥digo completo (para productos sin peso)
            if (!parsed.hasWeight) {
                for (const [mainCode, product] of Object.entries(products)) {
                    if (mainCode === barcode) {
                        return { product, mainCode };
                    }
                    if (product.altCodes && product.altCodes.includes(barcode)) {
                        return { product, mainCode };
                    }
                }
            }

            // Si tiene peso, buscar por los primeros 7 d√≠gitos
            for (const [mainCode, product] of Object.entries(products)) {
                const mainPrefix = mainCode.substring(0, 7);
                if (mainPrefix === parsed.productCode) {
                    return { product, mainCode };
                }
                if (product.altCodes) {
                    for (const altCode of product.altCodes) {
                        const altPrefix = altCode.substring(0, 7);
                        if (altPrefix === parsed.productCode) {
                            return { product, mainCode };
                        }
                    }
                }
            }
            return null;
        };

        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, []);

            return (
                <div className="toast">
                    {type === 'success' ? '‚úì' : '‚úó'}
                    <span>{message}</span>
                </div>
            );
        };

        // BASE DE DATOS DEFAULT DE PRODUCTOS CON LOS DATOS DEL EXCEL Y REGLAS APLICADAS
        const DEFAULT_PRODUCTS = {
            "7792798007547": { name: "Cerveza Quilmes 330cc", hasWeight: false, altCodes: [] },
            "779187512137": { name: "Havanna Mardel 4 unidades", hasWeight: false, altCodes: [] },
            "7790805131223": { name: "Intimo Blend (Cab-Mer-Malb)", hasWeight: false, altCodes: [] },
            "7790577046572": { name: "Los Delirios del Mariscal Blend", hasWeight: false, altCodes: [] },
            "7791875102137": { name: "Alfajor Havanna Mardel 4 unidades", hasWeight: false, altCodes: [] },
            "7791875000228": { name: "Havannets 12 unidades", hasWeight: false, altCodes: [] },
            "7796138000175": { name: "Coquena Tannat", hasWeight: false, altCodes: [] },
            "7794450004215": { name: "Gran Enemigo GUALTALLARY", hasWeight: false, altCodes: [] },
            "7794450005519": { name: "Gran Enemigo EL CEPILLO", hasWeight: false, altCodes: [] },
            "7794450004208": { name: "Gran Enemigo AGRELO", hasWeight: false, altCodes: [] },
            "2700003": { name: "Vacio por kg", hasWeight: true, altCodes: ["2720003"] },
            "2700037": { name: "Peceto Arg x KG", hasWeight: true, altCodes: ["2720037"] },
            "5608149030206": { name: "Quinta da Lapa Malbec Portugues", hasWeight: false, altCodes: [] },
            "7793670006993": { name: "Yerba Verdeflor Hierbas Serranas 500gr", hasWeight: false, altCodes: [] },
            "7793670400500": { name: "Yerba Verdeflor Peperina 500gr", hasWeight: false, altCodes: [] },
            "7790326002064": { name: "Yerba Pampa Organica 500gr", hasWeight: false, altCodes: [] },
            "779220000128": { name: "9 de Oro Agridulces", hasWeight: false, altCodes: [] },
            "779220000159": { name: "9 de Oro Salados", hasWeight: false, altCodes: [] },
            "7622201816384": { name: "Mantecol", hasWeight: false, altCodes: [] },
            "2700045": { name: "Chinchulines Porc.", hasWeight: true, altCodes: ["2720045"] },
            "2700043": { name: "Chorizo porc.", hasWeight: true, altCodes: ["2720043"] },
            "2700046": { name: "Mollejas Porc.", hasWeight: true, altCodes: ["2720046"] },
            "2700044": { name: "Morcilla porc.", hasWeight: true, altCodes: ["2720044"] },
            "2700013": { name: "Morcilla Criolla por kg", hasWeight: true, altCodes: ["2720013"] },
            "2700015": { name: "Chinchulines por kg", hasWeight: true, altCodes: ["2720015"] },
            "2700012": { name: "Chorizo Criollo", hasWeight: true, altCodes: ["2720012"] },
            "2700008": { name: "Mollejas de coraz√≥n por kg", hasWeight: true, altCodes: ["2720008"] },
            "2720070": { name: "Bife de Chorizo Arg 250gr", hasWeight: true, altCodes: ["2700070"] },
            "2720030": { name: "Bife de Chorizo Arg 500gr", hasWeight: true, altCodes: ["2700030"] },
            "2720068": { name: "Bife de Chorizo Arg Entero", hasWeight: true, altCodes: ["2700068"] },
            "2720020": { name: "Bife de chorizo Arg x kg", hasWeight: true, altCodes: ["2700020"] },
            "2720023": { name: "Colita de Cuadril Arg x kg", hasWeight: true, altCodes: ["2700023"] },
            "2720069": { name: "Corazon de Cuadril Arg 250gr", hasWeight: true, altCodes: ["2700069"] },
            "2720026": { name: "Corazon de Cuadril Arg x kg", hasWeight: true, altCodes: ["2700026"] },
            "2720024": { name: "Entra√±as Arg x kg", hasWeight: true, altCodes: ["2700024"] },
            "2720028": { name: "Lomo Arg x kg", hasWeight: true, altCodes: ["2700028"] },
            "2720034": { name: "Lomo Arg Porc.", hasWeight: true, altCodes: ["2700034"] },
            "2720029": { name: "Medialuna de vacio Arg x kg", hasWeight: true, altCodes: ["2700029"] },
            "2700064": { name: "Medallon corazon de cuadril", hasWeight: true, altCodes: ["2720064"] },
            "2720071": { name: "Ojo de Bife Arg 250gr", hasWeight: true, altCodes: ["2700071"] },
            "2720031": { name: "Ojo de Bife Arg 500gr", hasWeight: true, altCodes: ["2700031"] },
            "2720021": { name: "Ojo de bife Arg x kg", hasWeight: true, altCodes: ["2700021"] },
            "2700036": { name: "Peceto Arg Bifes", hasWeight: true, altCodes: ["2720036"] },
            "2720022": { name: "Pica√±a Arg x kg", hasWeight: true, altCodes: ["2700022"] },
            "2720033": { name: "Pica√±a Arg Porc.", hasWeight: true, altCodes: ["2700033"] },
            "2720019": { name: "Vacio Arg x kg", hasWeight: true, altCodes: ["2700019"] },
            "2720038": { name: "Nalga para Milanesa Arg 500Gr", hasWeight: true, altCodes: ["2700038"] },
            "2720014": { name: "Nalga para Milanesa Arg x kg", hasWeight: true, altCodes: ["2700014"] },
            "2700002": { name: "Banderita por kg", hasWeight: true, altCodes: ["2720002"] },
            "2700041": { name: "Costillar Deshuesado Arg.", hasWeight: true, altCodes: ["2720041"] },
            "2700011": { name: "Bife de Chorizo x kg", hasWeight: true, altCodes: ["2720011"] },
            "2700006": { name: "Bife ancho x kg", hasWeight: true, altCodes: ["2720006"] },
            "2720009": { name: "Entra√±a por kg", hasWeight: true, altCodes: ["2700009"] },
            "2700004": { name: "Matambre de Vaca", hasWeight: true, altCodes: ["2720004"] },
            "2700005": { name: "Matambrito x kg", hasWeight: true, altCodes: ["2720005"] },
            "2700042": { name: "Falda Arg.", hasWeight: true, altCodes: ["2720042"] },
            "2700007": { name: "Carne para Estufar", hasWeight: true, altCodes: ["2720007"] },
            "2700001": { name: "Tira de asado por kg", hasWeight: true, altCodes: ["2720001"] },
            "2700016": { name: "Tira de asado porc.", hasWeight: true, altCodes: ["2720016", "2700054", "2720054"] },
            "2700050": { name: "Vacio entero", hasWeight: true, altCodes: ["2720050"] },
            "2700049": { name: "Costillar", hasWeight: true, altCodes: ["2720049"] },
            "270005500007": { name: "Aji molido seco x un.", hasWeight: true, altCodes: [] },
            "8425206001286": { name: "Chimichurri Do√±a Petrona normal x un.", hasWeight: false, altCodes: [] },
            "270005100001": { name: "Chimichurri Talho Argentino normal x un.", hasWeight: true, altCodes: [] },
            "27000520000": { name: "Chimichurri Talho Argentino picante x un.", hasWeight: true, altCodes: [] },
            "7790127000764": { name: "Chimichurri Vanoli", hasWeight: false, altCodes: [] },
            "7790150497081": { name: "Condimento para milanesa x un.", hasWeight: false, altCodes: [] },
            "7791004000068": { name: "Sal Parrillera Celusal 1kg", hasWeight: false, altCodes: [] },
            "7791875000020": { name: "Alfajores Havanna 12 unidades", hasWeight: false, altCodes: [] },
            "7791875006091": { name: "Alfajores Havanna 6 unidades Chocolate", hasWeight: false, altCodes: [] },
            "7791875000013": { name: "Alfajores Havanna 6 unidades mixto", hasWeight: false, altCodes: [] },
            "7791875006107": { name: "Alfajores Havanna 6u Merengue", hasWeight: false, altCodes: [] },
            "7791875101659": { name: "Alfajores super dulce de leche 4un.", hasWeight: false, altCodes: [] },
            "77958921": { name: "Bon o Bon Unidad", hasWeight: false, altCodes: [] },
            "7790040429406": { name: "Chocolinas", hasWeight: false, altCodes: [] },
            "7791875100003": { name: "Dulce de leche Havanna 250gr", hasWeight: false, altCodes: [] },
            "7791875005353": { name: "Dulce de leche Havanna 450gr", hasWeight: false, altCodes: [] },
            "7795735000328": { name: "Biszcochos Don Satur Salados", hasWeight: false, altCodes: [] },
            "7795735000335": { name: "Biscochos Don Satur Dulce", hasWeight: false, altCodes: [] },
            "7730241003661": { name: "Yerba Canarias 0.5 kg", hasWeight: false, altCodes: [] },
            "7730241003654": { name: "Yerba Canarias 1kg", hasWeight: false, altCodes: [] },
            "7790387015324": { name: "Yerba Ma√±anita 0.5 kg", hasWeight: false, altCodes: [] },
            "7790387015317": { name: "Yerba Ma√±anita 1kg", hasWeight: false, altCodes: [] },
            "7793704000911": { name: "Yerba Playadito 0.5 kg", hasWeight: false, altCodes: [] },
            "7793704000928": { name: "Yerba Playadito 1kg", hasWeight: false, altCodes: [] },
            "7790387110234": { name: "Yerba Taragui 0.5 kg", hasWeight: false, altCodes: [] },
            "7790387110159": { name: "Yerba Taragui 1kg", hasWeight: false, altCodes: [] },
            "270001700007": { name: "Empanadas Congeladas 3 unidades", hasWeight: true, altCodes: ["272001700007"] },
            "837655128342": { name: "Carbon Argentino 10kg", hasWeight: false, altCodes: [] },
            "837655127666": { name: "Carbon Argentino 3kg", hasWeight: false, altCodes: [] },
            "837655128519": { name: "Carbon Kamados 7kg", hasWeight: false, altCodes: [] },
            "837655128014": { name: "Encendedor", hasWeight: false, altCodes: [] },
            "7790070433169": { name: "Pan Rallado Preferido", hasWeight: false, altCodes: [] },
            "5603700058989": { name: "Provoletera", hasWeight: false, altCodes: [] },
            "7795711008539": { name: "Tapa para empanadas Fargo 14cm", hasWeight: false, altCodes: [] },
            "7790070631053": { name: "Tapa para Empanadas La Salte√±a", hasWeight: false, altCodes: [] },
            "7790070631060": { name: "Tapa de empanadas La Salte√±a Criollas", hasWeight: false, altCodes: [] },
            "2700010": { name: "Provoleta por kg", hasWeight: true, altCodes: ["2720010"] },
            "7794450008084": { name: "√Ålamos Malbec", hasWeight: false, altCodes: [] },
            "7794450008275": { name: "Angelica Zapata Malbec 2020", hasWeight: false, altCodes: [] },
            "7794450008961": { name: "Angelica Zapata Merlot 2016", hasWeight: false, altCodes: [] },
            "7790805120708": { name: "Black River Malbec", hasWeight: false, altCodes: [] },
            "7790805130004": { name: "Black River Merlot", hasWeight: false, altCodes: [] },
            "7790805730112": { name: "Black River Sauvignon Blanc", hasWeight: false, altCodes: [] },
            "7794450008053": { name: "Catena Malbec", hasWeight: false, altCodes: [] },
            "7794450090096": { name: "DV Catena Malbec-Malbec", hasWeight: false, altCodes: [] },
            "7794450005199": { name: "Catena Tinto Historico", hasWeight: false, altCodes: [] },
            "7794450002822": { name: "El Enemigo Bonarda", hasWeight: false, altCodes: [] },
            "7794450003645": { name: "El Enemigo Cabernet Franc", hasWeight: false, altCodes: [] },
            "7794450000972": { name: "El Enemigo Malbec", hasWeight: false, altCodes: [] },
            "7798136300158": { name: "El Esteco Malbec", hasWeight: false, altCodes: [] },
            "7790703167652": { name: "Famiglia Bianchi Chardonnay", hasWeight: false, altCodes: [] },
            "7798126082415": { name: "Gran Enemigo blend 2020", hasWeight: false, altCodes: [] },
            "7798126082279": { name: "Luca Pinot Noir", hasWeight: false, altCodes: [] },
            "7791203001231": { name: "Luigi Bosca Malbec", hasWeight: false, altCodes: [] },
            "7790762052838": { name: "La Mascota Cabernet Franc", hasWeight: false, altCodes: [] },
            "7790762050124": { name: "La Mascota Malbec", hasWeight: false, altCodes: [] },
            "7792319972002": { name: "Norton Vacazada Malbec", hasWeight: false, altCodes: [] },
            "7790577002332": { name: "Peque√±a Vasija malbec", hasWeight: false, altCodes: [] },
            "7790577043274": { name: "Rutini Dominio Malbec", hasWeight: false, altCodes: [] },
            "7791250002014": { name: "San Telmo Malbec 2023", hasWeight: false, altCodes: [] },
            "7791250002274": { name: "San Telmo Torrontes", hasWeight: false, altCodes: [] },
            "7790240042412": { name: "Trapiche Manos malbec 2005", hasWeight: false, altCodes: [] },
            "7790240072808": { name: "Trapiche Reserva Malbec", hasWeight: false, altCodes: [] },
            "7790577002165": { name: "Trumpeter Malbec", hasWeight: false, altCodes: [] },
            "7790577041553": { name: "Trumpeter Reserva Malbec", hasWeight: false, altCodes: [] },
            "7790577002189": { name: "Trumpeter Chardonnay", hasWeight: false, altCodes: [] },
            "7790577040617": { name: "Trumpeter Pinot Noir", hasWeight: false, altCodes: [] },
            "7790577040525": { name: "Trumpeter Sauvignon Blanc", hasWeight: false, altCodes: [] },
            "723849631142": { name: "Cerveza Bah American 33CL", hasWeight: false, altCodes: [] },
            "723849631159": { name: "Cerveza Bah Belgian 33CL", hasWeight: false, altCodes: [] },
            "723849631111": { name: "Cerveza Bah Ipa 33cl", hasWeight: false, altCodes: [] },
            "723849631203": { name: "Cerveza Bah Neipa 44CL", hasWeight: false, altCodes: [] },
            "723849631173": { name: "Cerveza Bah Session 44CL", hasWeight: false, altCodes: [] },
            "723849631180": { name: "Cerveza Bah Stout", hasWeight: false, altCodes: [] },
            "8053629030134": { name: "Cerveza Buenos Ayres", hasWeight: false, altCodes: [] },
            "7790290101602": { name: "Fernet Branca Argentino", hasWeight: false, altCodes: [] },
            "7790703167744": { name: "Bianchi Particular Malbec", hasWeight: false, altCodes: [] },
            "7798185960396": { name: "MANOS NEGRAS CHARDONNAY 2021", hasWeight: false, altCodes: [] },
            "7798370880119": { name: "The Llama Torrontes", hasWeight: false, altCodes: [] },
            "7790314055867": { name: "Buenos Aires Malbec 2024", hasWeight: false, altCodes: [] },
            "7790189042757": { name: "El Esteco Old Vines Criolla", hasWeight: false, altCodes: [] },
            "2720067": { name: "Ojo de bife Arg Entero", hasWeight: true, altCodes: ["2700067"] },
            "2720090": { name: "Nalga para Milanesa Arg Entera", hasWeight: true, altCodes: ["2700090"] },
            "2700040": { name: "Milanesas Preparadas", hasWeight: true, altCodes: ["2720040"] },
            "2700018": { name: "Empanadas Congeladas Carne Picante 3Un.", hasWeight: true, altCodes: ["2720018"] },
            "2700025": { name: "Peceto Arg. Entero", hasWeight: true, altCodes: ["2720025"] },
            "2901311": { name: "Nalga Fina x kg", hasWeight: true, altCodes: [] }
        };

        function App() {
            const [isLoggedIn, setIsLoggedIn] = React.useState(false);
            const [currentUser, setCurrentUser] = React.useState({ username: 'admin', role: 'admin' });
            const [products, setProducts] = React.useState(DEFAULT_PRODUCTS);
            const [currentList, setCurrentList] = React.useState([]);
            const [history, setHistory] = React.useState([]);
            const [activeTab, setActiveTab] = React.useState('scanner');
            const [barcodeInput, setBarcodeInput] = React.useState('');
            const [showModal, setShowModal] = React.useState(false);
            const [modalContent, setModalContent] = React.useState(null);
            const [toast, setToast] = React.useState(null);
            const scannerInputRef = React.useRef(null);

            React.useEffect(() => {
                const saved = localStorage.getItem('warehouse_history');
                if (saved) {
                    try { setHistory(JSON.parse(saved)); } catch (e) {}
                }
            }, []);

            React.useEffect(() => {
                localStorage.setItem('warehouse_history', JSON.stringify(history));
            }, [history]);

            const showToast = (message, type = 'success') => {
                setToast({ message, type });
            };

            const handleLogin = () => {
                setIsLoggedIn(true);
                showToast('Sistema iniciado', 'success');
            };

            const handleLogout = () => {
                if (window.confirm('¬øCerrar sesi√≥n? El historial actual se perder√°.')) {
                    setIsLoggedIn(false);
                    setCurrentList([]);
                    setHistory([]);
                    setActiveTab('scanner');
                }
            };

            const handleScan = (barcode) => {
                const parsed = parseBarcode(barcode);
                if (!parsed) {
                    showToast('C√≥digo inv√°lido (13 d√≠gitos)', 'error');
                    return;
                }

                const found = findProductByBarcode(barcode, products);
                if (!found) {
                    showToast(`Producto no encontrado: ${barcode}`, 'error');
                    return;
                }

                const { product, mainCode } = found;
                const existingIndex = currentList.findIndex(item => item.mainCode === mainCode);

                if (existingIndex >= 0) {
                    const newList = [...currentList];
                    if (parsed.hasWeight) {
                        newList[existingIndex].totalWeight += parsed.weight;
                    }
                    newList[existingIndex].units += 1;
                    newList[existingIndex].scans.push({ 
                        barcode, 
                        weight: parsed.weight,
                        timestamp: new Date().toISOString() 
                    });
                    setCurrentList(newList);
                } else {
                    setCurrentList([...currentList, {
                        mainCode: mainCode,
                        name: product.name,
                        hasWeight: product.hasWeight,
                        units: 1,
                        totalWeight: parsed.hasWeight ? parsed.weight : 0,
                        manualQuantity: '',
                        scans: [{ 
                            barcode, 
                            weight: parsed.weight,
                            timestamp: new Date().toISOString() 
                        }]
                    }]);
                }

                showToast(`‚úì ${product.name}`, 'success');
                setBarcodeInput('');
            };

            const handleBarcodeSubmit = (e) => {
                e.preventDefault();
                if (barcodeInput.length === 13) {
                    handleScan(barcodeInput);
                } else {
                    showToast('El c√≥digo debe tener 13 d√≠gitos', 'error');
                }
            };

            const updateManualQuantity = (index, value) => {
                const newList = [...currentList];
                newList[index].manualQuantity = value;
                setCurrentList(newList);
            };

            const calculateDifference = (item) => {
                if (!item.manualQuantity) return null;
                const manual = parseFloat(item.manualQuantity);
                if (isNaN(manual)) return null;

                const scanned = item.hasWeight ? item.totalWeight : item.units;
                return manual - scanned;
            };

            const showScanDetails = (item) => {
                setModalContent(
                    <div>
                        <h4 style={{ marginBottom: '16px' }}>
                            {item.name}
                        </h4>
                        <div style={{ marginBottom: '8px', fontSize: '13px', color: '#64748b' }}>
                            C√≥digo principal: {item.mainCode}
                        </div>
                        <div style={{ marginBottom: '16px', padding: '12px', background: '#f8fafc', borderRadius: '8px' }}>
                            <strong>Total escaneado:</strong> {item.units} unidades
                            {item.hasWeight && ` ‚Ä¢ ${item.totalWeight.toFixed(3)} kg`}
                        </div>
                        <h4 style={{ marginBottom: '12px', fontSize: '14px', color: '#64748b' }}>
                            Escaneos individuales ({item.scans.length}):
                        </h4>
                        {item.scans.map((scan, idx) => (
                            <div key={idx} className="scan-detail-item">
                                <div>
                                    <strong>#{idx + 1}</strong>
                                    <span style={{ marginLeft: '12px', fontFamily: 'Courier New, monospace', fontSize: '13px' }}>
                                        {scan.barcode}
                                    </span>
                                    {scan.weight > 0 && (
                                        <span style={{ marginLeft: '12px', color: '#667eea', fontWeight: '600' }}>
                                            {scan.weight.toFixed(3)} kg
                                        </span>
                                    )}
                                </div>
                                <div style={{ fontSize: '12px', color: '#64748b' }}>
                                    {new Date(scan.timestamp).toLocaleTimeString('es-AR')}
                                </div>
                            </div>
                        ))}
                    </div>
                );
                setShowModal(true);
            };

            const saveCurrentList = () => {
                if (currentList.length === 0) {
                    showToast('No hay productos para guardar', 'error');
                    return;
                }

                const newHistory = [{
                    id: Date.now().toString(),
                    date: new Date().toISOString(),
                    user: currentUser.username,
                    items: currentList,
                    totalProducts: currentList.length,
                    totalUnits: currentList.reduce((sum, item) => sum + item.units, 0)
                }, ...history];

                setHistory(newHistory);
                setCurrentList([]);
                showToast('Lista guardada en historial', 'success');
                setActiveTab('history');
            };

            const clearCurrentList = () => {
                if (window.confirm('¬øLimpiar la lista actual?')) {
                    setCurrentList([]);
                    showToast('Lista limpiada', 'success');
                }
            };

            const exportToExcel = () => {
                if (currentList.length === 0) {
                    showToast('No hay datos para exportar', 'error');
                    return;
                }

                // HOJA 1: Resumen consolidado
                const summaryData = currentList.map(item => ({
                    'C√≥digo': item.mainCode,
                    'Producto': item.name,
                    'Unidades': item.units,
                    'Peso Total (kg)': item.hasWeight ? item.totalWeight.toFixed(3) : 'N/A',
                    'Cantidad Manual': item.manualQuantity || '',
                    'Diferencia': (() => {
                        const diff = calculateDifference(item);
                        return diff !== null ? diff.toFixed(3) : '';
                    })()
                }));

                // HOJA 2: Detalle de todos los escaneos
                const detailData = [];
                currentList.forEach(item => {
                    item.scans.forEach((scan, idx) => {
                        detailData.push({
                            'Producto': item.name,
                            'C√≥digo Principal': item.mainCode,
                            'C√≥digo Escaneado': scan.barcode,
                            'Peso (kg)': scan.weight > 0 ? scan.weight.toFixed(3) : 'N/A',
                            'Fecha/Hora': new Date(scan.timestamp).toLocaleString('es-AR'),
                            'N¬∫ Escaneo': idx + 1
                        });
                    });
                });

                const wb = XLSX.utils.book_new();

                const ws1 = XLSX.utils.json_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, ws1, 'Resumen');

                const ws2 = XLSX.utils.json_to_sheet(detailData);
                XLSX.utils.book_append_sheet(wb, ws2, 'Detalle de Escaneos');

                XLSX.writeFile(wb, `recepcion_${new Date().toISOString().split('T')[0]}.xlsx`);
                showToast('Exportado a Excel (2 hojas)', 'success');
            };

            React.useEffect(() => {
                if (activeTab === 'scanner' && scannerInputRef.current) {
                    scannerInputRef.current.focus();
                }
            }, [activeTab]);

            if (!isLoggedIn) {
                return <LoginScreen onLogin={handleLogin} />;
            }

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>üì¶ Sistema de Recepci√≥n</h1>
                        <div className="header-info">
                            <span className="user-badge">
                                {currentUser.username}
                            </span>
                            <button className="icon-btn" onClick={handleLogout} title="Cerrar sesi√≥n">
                                ‚éã
                            </button>
                        </div>
                    </div>

                    <div className="card">
                        <div className="tabs">
                            <button 
                                className={`tab ${activeTab === 'scanner' ? 'active' : ''}`}
                                onClick={() => setActiveTab('scanner')}
                            >
                                üì± Escanear
                            </button>
                            <button 
                                className={`tab ${activeTab === 'admin' ? 'active' : ''}`}
                                onClick={() => setActiveTab('admin')}
                            >
                                ‚öôÔ∏è Productos ({Object.keys(products).length})
                            </button>
                            <button 
                                className={`tab ${activeTab === 'history' ? 'active' : ''}`}
                                onClick={() => setActiveTab('history')}
                            >
                                üìã Historial ({history.length})
                            </button>
                        </div>

                        {activeTab === 'scanner' && (
                            <ScannerTab
                                currentList={currentList}
                                barcodeInput={barcodeInput}
                                setBarcodeInput={setBarcodeInput}
                                handleBarcodeSubmit={handleBarcodeSubmit}
                                updateManualQuantity={updateManualQuantity}
                                calculateDifference={calculateDifference}
                                saveCurrentList={saveCurrentList}
                                clearCurrentList={clearCurrentList}
                                exportToExcel={exportToExcel}
                                scannerInputRef={scannerInputRef}
                                showScanDetails={showScanDetails}
                            />
                        )}

                        {activeTab === 'admin' && (
                            <AdminTab
                                products={products}
                                setProducts={setProducts}
                            />
                        )}

                        {activeTab === 'history' && (
                            <HistoryTab 
                                history={history} 
                                setModalContent={setModalContent}
                                setShowModal={setShowModal}
                                showScanDetails={showScanDetails}
                            />
                        )}
                    </div>

                    {showModal && (
                        <div className="modal" onClick={() => setShowModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>Detalle</h3>
                                    <button className="close-btn" onClick={() => setShowModal(false)}>√ó</button>
                                </div>
                                {modalContent}
                            </div>
                        </div>
                    )}

                    {toast && (
                        <Toast 
                            message={toast.message} 
                            type={toast.type} 
                            onClose={() => setToast(null)} 
                        />
                    )}
                </div>
            );
        }

        const LoginScreen = ({ onLogin }) => {
            return (
                <div className="login-container">
                    <div className="login-header">
                        <h1>üì¶ Sistema de Recepci√≥n</h1>
                        <p>Versi√≥n mejorada con detecci√≥n autom√°tica</p>
                    </div>
                    <button onClick={onLogin} className="btn btn-primary">
                        Iniciar Sistema
                    </button>
                    <div style={{ marginTop: '20px', padding: '12px', background: '#dcfce7', borderRadius: '8px', fontSize: '13px', color: '#166534' }}>
                        <strong>‚úì Mejoras incluidas:</strong><br/>
                        ‚Ä¢ C√≥digos de 13 d√≠gitos<br/>
                        ‚Ä¢ Detecci√≥n autom√°tica de peso (27, 29, 21)<br/>
                        ‚Ä¢ M√∫ltiples c√≥digos por producto<br/>
                        ‚Ä¢ Exporta 2 hojas Excel (resumen + detalle)
                    </div>
                </div>
            );
        };

        const ScannerTab = ({ 
            currentList, 
            barcodeInput, 
            setBarcodeInput, 
            handleBarcodeSubmit,
            updateManualQuantity,
            calculateDifference,
            saveCurrentList,
            clearCurrentList,
            exportToExcel,
            scannerInputRef,
            showScanDetails
        }) => {
            return (
                <>
                    <form onSubmit={handleBarcodeSubmit}>
                        <div className="scanner-input">
                            <input
                                ref={scannerInputRef}
                                type="text"
                                value={barcodeInput}
                                onChange={(e) => setBarcodeInput(e.target.value)}
                                placeholder="Escanea c√≥digo de barras (13 d√≠gitos)"
                                maxLength="13"
                            />
                            <button type="submit" className="btn btn-primary" style={{ width: 'auto', padding: '0 30px' }}>
                                Agregar
                            </button>
                        </div>
                    </form>

                    <div className="product-list">
                        {currentList.length === 0 ? (
                            <div className="empty-state">
                                <div style={{ fontSize: '48px', marginBottom: '16px' }}>üì¶</div>
                                <p>No hay productos escaneados</p>
                                <p style={{ fontSize: '13px', marginTop: '8px', color: '#64748b' }}>
                                    Haz clic en un producto para ver el detalle de escaneos
                                </p>
                            </div>
                        ) : (
                            currentList.map((item, index) => {
                                const diff = calculateDifference(item);
                                return (
                                    <div 
                                        key={index} 
                                        className="product-item"
                                        onClick={() => showScanDetails(item)}
                                        title="Click para ver detalle de escaneos"
                                    >
                                        <div className="product-name">
                                            {item.name}
                                            <div className="product-code">{item.mainCode.substring(0, 7)}...</div>
                                        </div>

                                        <div className="product-stat">
                                            <div className="stat-label">Unidades</div>
                                            <div className="stat-value">{item.units}</div>
                                        </div>

                                        {item.hasWeight && (
                                            <div className="product-stat">
                                                <div className="stat-label">Peso</div>
                                                <div className="stat-value">
                                                    {item.totalWeight.toFixed(3)}
                                                </div>
                                            </div>
                                        )}

                                        <div className="manual-input-inline" onClick={(e) => e.stopPropagation()}>
                                            <input
                                                type="number"
                                                step="0.001"
                                                value={item.manualQuantity}
                                                onChange={(e) => updateManualQuantity(index, e.target.value)}
                                                placeholder="Manual"
                                            />
                                            {diff !== null && diff !== 0 && (
                                                <span className={`difference-badge ${diff > 0 ? 'positive' : 'negative'}`}>
                                                    {diff > 0 ? '+' : ''}{Math.abs(diff).toFixed(2)}
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>

                    {currentList.length > 0 && (
                        <>
                            <div style={{ marginTop: '20px', padding: '16px', background: '#f8fafc', borderRadius: '8px', display: 'flex', justifyContent: 'space-around' }}>
                                <div>
                                    <div style={{ fontSize: '12px', color: '#64748b' }}>Productos</div>
                                    <div style={{ fontSize: '20px', fontWeight: '700' }}>{currentList.length}</div>
                                </div>
                                <div>
                                    <div style={{ fontSize: '12px', color: '#64748b' }}>Unidades</div>
                                    <div style={{ fontSize: '20px', fontWeight: '700' }}>
                                        {currentList.reduce((sum, item) => sum + item.units, 0)}
                                    </div>
                                </div>
                                <div>
                                    <div style={{ fontSize: '12px', color: '#64748b' }}>Peso Total</div>
                                    <div style={{ fontSize: '20px', fontWeight: '700' }}>
                                        {currentList.reduce((sum, item) => sum + (item.hasWeight ? item.totalWeight : 0), 0).toFixed(3)} kg
                                    </div>
                                </div>
                            </div>
                            <div className="actions">
                                <button className="btn btn-success" onClick={saveCurrentList}>
                                    üíæ Guardar
                                </button>
                                <button className="btn btn-secondary" onClick={exportToExcel}>
                                    üì• Excel (2 hojas)
                                </button>
                                <button className="btn btn-danger" onClick={clearCurrentList}>
                                    üóëÔ∏è Limpiar
                                </button>
                            </div>
                        </>
                    )}
                </>
            );
        };

        const AdminTab = ({ products, setProducts }) => {
            const [newProductCode, setNewProductCode] = React.useState('');
            const [newProductName, setNewProductName] = React.useState('');
            const [editingProduct, setEditingProduct] = React.useState(null);
            const [newAltCode, setNewAltCode] = React.useState('');

            const addProductManually = () => {
                if (!newProductCode || !newProductName || newProductCode.length !== 13) {
                    alert('C√≥digo debe ser 13 d√≠gitos y nombre requerido');
                    return;
                }

                const prefix = newProductCode.substring(0, 2);
                const hasWeight = ['27', '29', '21'].includes(prefix);

                setProducts({ ...products, [newProductCode]: { name: newProductName, hasWeight, altCodes: [] } });
                setNewProductCode('');
                setNewProductName('');
            };

            const addAltCode = (mainCode) => {
                if (!newAltCode || newAltCode.length !== 13) {
                    alert('C√≥digo alternativo debe tener 13 d√≠gitos');
                    return;
                }

                if (newAltCode === mainCode) {
                    alert('El c√≥digo alternativo no puede ser igual al principal');
                    return;
                }

                const newProducts = { ...products };
                if (!newProducts[mainCode].altCodes) {
                    newProducts[mainCode].altCodes = [];
                }

                if (newProducts[mainCode].altCodes.includes(newAltCode)) {
                    alert('Este c√≥digo ya existe');
                    return;
                }

                if (newProducts[mainCode].altCodes.length >= 3) {
                    alert('M√°ximo 3 c√≥digos alternativos');
                    return;
                }

                newProducts[mainCode].altCodes.push(newAltCode);
                setProducts(newProducts);
                setNewAltCode('');
            };

            const removeAltCode = (mainCode, altCode) => {
                const newProducts = { ...products };
                newProducts[mainCode].altCodes = newProducts[mainCode].altCodes.filter(c => c !== altCode);
                setProducts(newProducts);
            };

            const deleteProduct = (code) => {
                if (!window.confirm(`¬øEliminar ${products[code].name}?`)) return;
                const newProducts = { ...products };
                delete newProducts[code];
                setProducts(newProducts);
            };

            return (
                <div>
                    <div className="info-box">
                        <strong>‚ÑπÔ∏è Detecci√≥n autom√°tica de peso:</strong> Los c√≥digos que comienzan con 27, 29 o 21 se marcan autom√°ticamente como "con peso". Los dem√°s como "sin peso".
                    </div>

                    <div className="admin-section">
                        <h3>Agregar Producto Manualmente</h3>
                        <div className="add-product-form">
                            <input
                                type="text"
                                placeholder="C√≥digo (13 d√≠gitos)"
                                value={newProductCode}
                                onChange={(e) => setNewProductCode(e.target.value)}
                                maxLength="13"
                                style={{ flex: '0 1 180px' }}
                            />
                            <input
                                type="text"
                                placeholder="Nombre"
                                value={newProductName}
                                onChange={(e) => setNewProductName(e.target.value)}
                                style={{ flex: '1 1 200px' }}
                            />
                            <button 
                                className="btn btn-primary" 
                                onClick={addProductManually}
                                style={{ width: 'auto', padding: '8px 20px' }}
                            >
                                Agregar
                            </button>
                        </div>
                    </div>

                    <div className="product-catalog">
                        <div style={{ padding: '12px', background: '#f8fafc', fontWeight: 600, borderBottom: '2px solid #e2e8f0' }}>
                            Productos ({Object.keys(products).length})
                        </div>
                        {Object.keys(products).length === 0 ? (
                            <div style={{ padding: '40px', textAlign: 'center', color: '#64748b' }}>
                                No hay productos. Agrega manualmente.
                            </div>
                        ) : (
                            Object.entries(products).map(([code, product]) => (
                                <div key={code}>
                                    <div className="catalog-item">
                                        <div style={{ flex: 1 }}>
                                            <strong>{product.name}</strong><br/>
                                            <small style={{ color: '#64748b' }}>
                                                C√≥digo: {code} ‚Ä¢ {product.hasWeight ? '‚öñÔ∏è Con peso' : 'üì¶ Sin peso'}
                                            </small>
                                            {product.altCodes && product.altCodes.length > 0 && (
                                                <div className="barcode-list">
                                                    {product.altCodes.map(altCode => (
                                                        <div key={altCode} className="barcode-chip">
                                                            {altCode}
                                                            <button onClick={() => removeAltCode(code, altCode)}>√ó</button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                        <div style={{ display: 'flex', gap: '8px' }}>
                                            <button 
                                                className="small-btn"
                                                style={{ background: '#e0e7ff', color: '#3730a3' }}
                                                onClick={() => setEditingProduct(editingProduct === code ? null : code)}
                                            >
                                                + C√≥digo
                                            </button>
                                            <button 
                                                className="small-btn small-btn-danger"
                                                onClick={() => deleteProduct(code)}
                                            >
                                                Eliminar
                                            </button>
                                        </div>
                                    </div>
                                    {editingProduct === code && (
                                        <div className="barcode-input-section">
                                            <div style={{ fontSize: '13px', marginBottom: '8px', color: '#64748b' }}>
                                                Agregar c√≥digo alternativo ({product.altCodes?.length || 0}/3):
                                            </div>
                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                <input
                                                    type="text"
                                                    placeholder="C√≥digo alternativo (13 d√≠gitos)"
                                                    value={newAltCode}
                                                    onChange={(e) => setNewAltCode(e.target.value)}
                                                    maxLength="13"
                                                    style={{ flex: 1, padding: '8px', border: '1px solid #cbd5e1', borderRadius: '6px' }}
                                                />
                                                <button 
                                                    className="btn btn-primary"
                                                    onClick={() => addAltCode(code)}
                                                    style={{ width: 'auto', padding: '8px 20px' }}
                                                >
                                                    Agregar
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        };

        const HistoryTab = ({ history, setModalContent, setShowModal, showScanDetails }) => {
            const viewDetails = (item) => {
                setModalContent(
                    <div>
                        <div style={{ marginBottom: '20px', padding: '16px', background: '#f8fafc', borderRadius: '8px' }}>
                            <strong>Fecha:</strong> {new Date(item.date).toLocaleString('es-AR')}<br/>
                            <strong>Usuario:</strong> {item.user}<br/>
                            <strong>Productos diferentes:</strong> {item.totalProducts}<br/>
                            <strong>Unidades totales:</strong> {item.totalUnits}
                        </div>
                        <h4 style={{ marginBottom: '16px' }}>Productos:</h4>
                        {item.items.map((product, idx) => (
                            <div 
                                key={idx} 
                                style={{ 
                                    padding: '12px', 
                                    background: '#f8fafc', 
                                    borderRadius: '8px', 
                                    marginBottom: '12px',
                                    cursor: 'pointer',
                                    border: '1px solid #e2e8f0'
                                }}
                                onClick={() => showScanDetails(product)}
                            >
                                <strong>{product.name}</strong><br/>
                                <small>C√≥digo: {product.mainCode}</small><br/>
                                Unidades: {product.units} ‚Ä¢ Escaneos: {product.scans.length}<br/>
                                {product.hasWeight && `Peso: ${product.totalWeight.toFixed(3)} kg`}<br/>
                                {product.manualQuantity && `Manual: ${product.manualQuantity}`}
                                <div style={{ fontSize: '11px', color: '#667eea', marginTop: '4px' }}>
                                    Click para ver detalle de escaneos ‚Üí
                                </div>
                            </div>
                        ))}
                    </div>
                );
                setShowModal(true);
            };

            return (
                <div className="history-list">
                    {history.length === 0 ? (
                        <div className="empty-state">
                            <div style={{ fontSize: '48px', marginBottom: '16px' }}>üìã</div>
                            <p>No hay recepciones guardadas</p>
                        </div>
                    ) : (
                        history.map(item => (
                            <div key={item.id} className="history-item" onClick={() => viewDetails(item)}>
                                <div className="history-header">
                                    <div className="history-date">
                                        {new Date(item.date).toLocaleDateString('es-AR', { 
                                            day: '2-digit', 
                                            month: '2-digit', 
                                            year: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        })}
                                    </div>
                                    <div className="history-badge">{item.totalProducts} productos</div>
                                </div>
                                <div className="history-summary">
                                    {item.totalUnits} unidades totales
                                </div>
                            </div>
                        ))
                    )}
                </div>
            );
        };

        
// A√±adir c√≥digos de la columna 'codigo 3' del Excel a las altCodes (insertado autom√°ticamente)
(function addCodigo3(){
    const CODIGO_3_MAP = {
        '2700003': '2901306',
        '2700002': '2901304',
        '2700006': '2901307',
        '2700004': '2901305',
        '2700005': '2901309',
        '2700001': '2901303',
        '2700050': '2901308',
        '2700049': '2901302'
    };
    for (const [main, c3] of Object.entries(CODIGO_3_MAP)) {
        try {
            if (typeof DEFAULT_PRODUCTS !== 'undefined' && DEFAULT_PRODUCTS[main]) {
                DEFAULT_PRODUCTS[main].altCodes = DEFAULT_PRODUCTS[main].altCodes || [];
                if (!DEFAULT_PRODUCTS[main].altCodes.includes(c3)) DEFAULT_PRODUCTS[main].altCodes.push(c3);
            }
        } catch(e) { console.error('Error applying codigo3 map', e); }
    }
})();

ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
